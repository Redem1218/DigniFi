<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Endurance Agent Portal - Flexible Lead Distribution</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #1e5a6f 0%, #0f3647 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .header p {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
    }

    .content {
      padding: 30px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    .form-column {
      display: flex;
      flex-direction: column;
    }

    .map-column {
      display: flex;
      flex-direction: column;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 700;
      color: #1e5a6f;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }

    .section-title::before {
      content: '';
      display: inline-block;
      width: 4px;
      height: 16px;
      background: #ff6b4a;
      margin-right: 12px;
      border-radius: 2px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"] {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid #eef2f7;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s ease;
    }

    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="tel"]:focus {
      outline: none;
      border-color: #ff6b4a;
      box-shadow: 0 0 0 3px rgba(255, 107, 74, 0.1);
    }

    .contact-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .search-input-wrapper {
      display: flex;
      gap: 10px;
    }

    input#zipcode {
      flex: 1;
    }

    .search-btn {
      padding: 12px 20px;
      background: #1e5a6f;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .search-btn:hover {
      background: #0f3647;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30, 90, 111, 0.2);
    }

    .search-btn.loading {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .selection-info {
      background: #d6eaf8;
      border: 1px solid #aed6f1;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 12px;
      color: #1e5a6f;
    }

    .location-list {
      max-height: 400px;
      overflow-y: auto;
      border: 2px solid #eef2f7;
      border-radius: 6px;
      margin-top: 15px;
    }

    .location-item {
      padding: 14px;
      border-bottom: 1px solid #eef2f7;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .location-item:last-child {
      border-bottom: none;
    }

    .location-item:hover {
      background: #f9fafb;
    }

    .location-item.non-enrolled {
      background: #fdf9f0;
    }

    .location-item.non-enrolled:hover {
      background: #fdf5e8;
    }

    .checkbox-indicator {
      width: 18px;
      height: 18px;
      min-width: 18px;
      border: 2px solid #1e5a6f;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      margin-top: 2px;
    }

    .location-item input[type="radio"],
    .location-item input[type="checkbox"] {
      display: none;
    }

    .location-item.enrolled input[type="radio"]:checked + .location-details .checkbox-indicator {
      background: #27ae60;
      border-color: #27ae60;
    }

    .location-item.enrolled input[type="radio"]:checked + .location-details .checkbox-indicator::after {
      content: '‚úì';
      color: white;
      font-size: 12px;
      font-weight: bold;
    }

    .location-item.non-enrolled input[type="checkbox"]:checked + .location-details .checkbox-indicator {
      background: #ff6b4a;
      border-color: #ff6b4a;
    }

    .location-item.non-enrolled input[type="checkbox"]:checked + .location-details .checkbox-indicator::after {
      content: '‚úì';
      color: white;
      font-size: 12px;
      font-weight: bold;
    }

    .location-details {
      flex: 1;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      cursor: pointer;
    }

    .location-info {
      flex: 1;
    }

    .location-name {
      font-size: 13px;
      font-weight: 700;
      color: #1e5a6f;
      margin-bottom: 4px;
    }

    .location-address {
      font-size: 12px;
      color: #7f8c8d;
      margin-bottom: 4px;
    }

    .location-distance {
      font-size: 11px;
      color: #ff6b4a;
      font-weight: 600;
    }

    .enrollment-badge {
      display: inline-block;
      font-size: 10px;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 3px;
      margin-left: 6px;
    }

    .enrollment-badge.enrolled {
      background: #d5f4e6;
      color: #27ae60;
    }

    .enrollment-badge.not-enrolled {
      background: #fff3cd;
      color: #ff9800;
    }

    .no-results {
      padding: 20px;
      text-align: center;
      color: #7f8c8d;
      font-size: 13px;
    }

    .selected-summary {
      background: #f0f8fb;
      border: 2px solid #1e5a6f;
      border-radius: 6px;
      padding: 14px;
      margin-top: 15px;
    }

    .selected-summary-title {
      font-size: 12px;
      font-weight: 700;
      color: #1e5a6f;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .selected-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 12px;
    }

    .selected-item:last-child {
      margin-bottom: 0;
    }

    .selected-item::before {
      content: '‚úì';
      width: 20px;
      height: 20px;
      background: #27ae60;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 11px;
      flex-shrink: 0;
    }

    .selected-item.outreach::before {
      background: #ff6b4a;
    }

    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 20px;
    }

    .action-button {
      padding: 14px 16px;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .send-prequal-btn {
      background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
    }

    .send-prequal-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3);
    }

    .send-outreach-btn {
      background: linear-gradient(135deg, #ff6b4a 0%, #e55a3a 100%);
    }

    .send-outreach-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 107, 74, 0.3);
    }

    .action-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .form-status {
      margin-top: 20px;
      padding: 14px;
      border-radius: 6px;
      text-align: center;
      font-size: 13px;
      display: none;
    }

    .form-status.error {
      background: #fadbd8;
      color: #c0392b;
      border: 1px solid #f5b7b1;
      display: block;
    }

    .form-status.success {
      background: #d5f4e6;
      color: #27ae60;
      border: 1px solid #a9dfbf;
      display: block;
    }

    .form-status.info {
      background: #d6eaf8;
      color: #1e5a6f;
      border: 1px solid #aed6f1;
      display: block;
    }

    #mapContainer {
      flex: 1;
      border-radius: 6px;
      overflow: hidden;
      border: 2px solid #eef2f7;
      min-height: 500px;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    .map-legend {
      background: white;
      padding: 14px;
      border-radius: 6px;
      margin-top: 15px;
      font-size: 12px;
      border: 2px solid #eef2f7;
    }

    .map-legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .map-legend-item:last-child {
      margin-bottom: 0;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .legend-primary {
      background: #27ae60;
      border: 2px solid #1e5a6f;
    }

    .legend-outreach {
      background: #ff6b4a;
      border: 2px solid #e55a3a;
    }

    @media (max-width: 1024px) {
      .content {
        grid-template-columns: 1fr;
      }

      #mapContainer {
        min-height: 300px;
      }
    }

    @media (max-width: 600px) {
      .container {
        border-radius: 0;
      }

      .button-group {
        grid-template-columns: 1fr;
      }

      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 22px;
      }

      .contact-options {
        grid-template-columns: 1fr;
      }

      .location-list {
        max-height: 300px;
      }

      #mapContainer {
        min-height: 250px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Endurance Agent Portal</h1>
      <p>PreQual Fulfillment + Selective Lead Outreach</p>
    </div>

    <div class="content">
      <div class="form-column">
        <form id="prequalForm">
          <div class="form-section">
            <div class="section-title">Customer Information</div>
            <div class="form-group">
              <label for="customerName">Customer Name *</label>
              <input type="text" id="customerName" name="customerName" placeholder="John Doe" required>
            </div>
            <div class="contact-options">
              <div class="form-group">
                <label for="customerEmail">Email *</label>
                <input type="email" id="customerEmail" name="customerEmail" placeholder="john@example.com" required>
              </div>
              <div class="form-group">
                <label for="customerPhone">Phone *</label>
                <input type="tel" id="customerPhone" name="customerPhone" placeholder="(555) 123-4567" required>
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="section-title">Select Service Centers</div>
            
            <div class="selection-info">
              <strong>PreQual Option (Optional):</strong> Select 1 DigniFi Enrolled center<br>
              <strong>Lead Outreach Option (Optional):</strong> Check non-enrolled competitors to reach out
            </div>

            <div class="search-container">
              <div class="search-input-wrapper">
                <input 
                  type="text" 
                  id="zipcode" 
                  name="zipcode" 
                  placeholder="Enter zip code (e.g., 37174)" 
                  maxlength="5"
                  required
                >
                <button type="button" class="search-btn" id="searchBtn">Search</button>
              </div>
            </div>

            <div id="locationResults"></div>
            <div id="selectedSummary"></div>
          </div>

          <div class="form-section">
            <div class="button-group">
              <button type="button" class="action-button send-prequal-btn" id="sendPrequalBtn" disabled>
                Send PreQualification Invite
              </button>
              <button type="button" class="action-button send-outreach-btn" id="sendOutreachBtn" disabled>
                Send Lead Outreach Only
              </button>
            </div>
            <div id="formStatus" class="form-status"></div>
          </div>
        </form>
      </div>

      <div class="map-column">
        <div class="section-title" style="margin-bottom: 15px;">Service Center Map</div>
        <div id="mapContainer">
          <div id="map"></div>
        </div>
        <div class="map-legend">
          <div class="map-legend-item">
            <div class="legend-color legend-primary"></div>
            <span>Selected for PreQual (Green)</span>
          </div>
          <div class="map-legend-item">
            <div class="legend-color legend-outreach"></div>
            <span>Selected for Lead Outreach (Orange)</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <script>
    const digniFiLocations = {
      '37174': [
        { id: 1, name: 'Smitty\'s Auto Repair', address: '123 Main St, Franklin, TN 37174', distance: '0.3 mi', lat: 35.1745, lng: -86.8681, enrolled: true },
        { id: 2, name: 'Downtown Service Center', address: '456 5th Ave, Franklin, TN 37174', distance: '1.2 mi', lat: 35.1750, lng: -86.8690, enrolled: false },
        { id: 3, name: 'DigniFi Express', address: '789 Commerce Ave, Franklin, TN 37174', distance: '2.1 mi', lat: 35.1760, lng: -86.8700, enrolled: true }
      ],
      '37064': [
        { id: 200, name: 'Franklin Motor Service', address: '1001 Murfreesboro Rd, Franklin, TN 37064', distance: '0.5 mi', lat: 35.1812, lng: -86.8620, enrolled: true },
        { id: 201, name: 'Liberty Auto Repair', address: '1112 Riverside Dr, Franklin, TN 37064', distance: '1.0 mi', lat: 35.1825, lng: -86.8610, enrolled: false },
        { id: 202, name: 'Premier Auto Care', address: '1223 Galleria Blvd, Franklin, TN 37064', distance: '1.6 mi', lat: 35.1840, lng: -86.8600, enrolled: false }
      ],
      '37067': [
        { id: 4, name: 'Williamson Garage', address: '321 Oak Ln, Brentwood, TN 37067', distance: '0.8 mi', lat: 35.7829, lng: -86.7823, enrolled: true },
        { id: 5, name: 'Quick Fix Auto', address: '654 Maple Dr, Brentwood, TN 37067', distance: '1.5 mi', lat: 35.7845, lng: -86.7840, enrolled: false },
        { id: 6, name: 'Elite Service Pros', address: '987 Elm St, Brentwood, TN 37067', distance: '2.0 mi', lat: 35.7860, lng: -86.7860, enrolled: true },
        { id: 7, name: 'Brentwood Auto Works', address: '234 Concord Ave, Brentwood, TN 37067', distance: '1.1 mi', lat: 35.7835, lng: -86.7850, enrolled: false }
      ],
      '37027': [
        { id: 215, name: 'Brentwood Premier Service', address: '5001 Maryland Way, Brentwood, TN 37027', distance: '0.4 mi', lat: 35.7900, lng: -86.7750, enrolled: true },
        { id: 216, name: 'DigniFi Brentwood Express', address: '5112 Saundersville Rd, Brentwood, TN 37027', distance: '0.9 mi', lat: 35.7915, lng: -86.7740, enrolled: true },
        { id: 217, name: 'Quality Auto Solutions', address: '5223 Moores Lane, Brentwood, TN 37027', distance: '1.4 mi', lat: 35.7930, lng: -86.7730, enrolled: false },
        { id: 218, name: 'Brentwood Automotive Hub', address: '5334 Franklin Rd, Brentwood, TN 37027', distance: '1.9 mi', lat: 35.7945, lng: -86.7720, enrolled: false }
      ],
      '60601': [
        { id: 300, name: 'Loop Auto Service Center', address: '233 S Wacker Dr, Chicago, IL 60601', distance: '0.3 mi', lat: 41.8787, lng: -87.6356, enrolled: true },
        { id: 301, name: 'Downtown Chicago Motors', address: '100 E Randolph St, Chicago, IL 60601', distance: '0.7 mi', lat: 41.8833, lng: -87.6278, enrolled: false },
        { id: 302, name: 'DigniFi Chicago Loop', address: '311 S Wacker Dr, Chicago, IL 60601', distance: '1.1 mi', lat: 41.8765, lng: -87.6375, enrolled: true }
      ],
      '60173': [
        { id: 330, name: 'Schaumburg Auto Service', address: '1001 N Roselle Rd, Schaumburg, IL 60173', distance: '0.4 mi', lat: 42.0456, lng: -88.0789, enrolled: true },
        { id: 331, name: 'Schaumburg Motors', address: '1300 S Roselle Rd, Schaumburg, IL 60173', distance: '0.9 mi', lat: 42.0356, lng: -88.0801, enrolled: false },
        { id: 332, name: 'DigniFi Schaumburg Hub', address: '1600 N Springinsguth Rd, Schaumburg, IL 60173', distance: '1.4 mi', lat: 42.0489, lng: -88.0634, enrolled: true },
        { id: 333, name: 'Woodfield Auto Center', address: '1900 E Woodfield Rd, Schaumburg, IL 60173', distance: '1.9 mi', lat: 42.0278, lng: -88.0523, enrolled: false }
      ]
    };

    let map;
    let selectedPrimaryCenter = null;
    let selectedOutreachCenters = new Set();
    let currentMarkers = [];
    let currentLocations = [];

    const form = document.getElementById('prequalForm');
    const searchBtn = document.getElementById('searchBtn');
    const sendPrequalBtn = document.getElementById('sendPrequalBtn');
    const sendOutreachBtn = document.getElementById('sendOutreachBtn');
    const zipcodeInput = document.getElementById('zipcode');
    const locationResults = document.getElementById('locationResults');
    const selectedSummary = document.getElementById('selectedSummary');
    const formStatus = document.getElementById('formStatus');

    function initializeMap() {
      const centroidLat = 36.1627;
      const centroidLng = -86.7816;
      
      map = L.map('map').setView([centroidLat, centroidLng], 12);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors',
        maxZoom: 19
      }).addTo(map);
    }

    function clearMarkers() {
      currentMarkers.forEach(marker => map.removeLayer(marker));
      currentMarkers = [];
    }

    function addMarkersToMap(locations) {
      clearMarkers();

      locations.forEach(location => {
        let color = '#3388ff';
        if (location.id === selectedPrimaryCenter) {
          color = '#27ae60';
        } else if (selectedOutreachCenters.has(location.id)) {
          color = '#ff6b4a';
        }
        
        const icon = L.divIcon({
          className: 'custom-marker',
          html: `<div style="background: ${color}; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); cursor: pointer; font-weight: bold; color: white; font-size: 14px;">üìç</div>`,
          iconSize: [32, 32],
          iconAnchor: [16, 32],
          popupAnchor: [0, -32]
        });

        const marker = L.marker([location.lat, location.lng], { icon: icon })
          .bindPopup(`
            <div style="font-family: inherit; font-size: 12px;">
              <div style="font-weight: 700; color: #1e5a6f; margin-bottom: 4px;">${location.name}</div>
              <div style="color: #7f8c8d; margin-bottom: 4px;">${location.address}</div>
              <div style="color: #ff6b4a; font-weight: 600; margin-bottom: 4px;">üìç ${location.distance} away</div>
              <div style="font-size: 11px; margin-top: 6px; padding-top: 6px; border-top: 1px solid #eee;">
                ${location.enrolled ? '‚úì DigniFi Enrolled' : '‚Ä¢ Non-Enrolled'}
              </div>
            </div>
          `)
          .addTo(map);

        currentMarkers.push(marker);
      });

      if (currentMarkers.length > 0) {
        const group = new L.featureGroup(currentMarkers);
        map.fitBounds(group.getBounds().pad(0.1));
      }
    }

    document.getElementById('customerPhone').addEventListener('input', (e) => {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 0) {
        if (value.length <= 3) {
          value = `(${value}`;
        } else if (value.length <= 6) {
          value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
        } else {
          value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
        }
      }
      e.target.value = value;
    });

    zipcodeInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/\D/g, '').slice(0, 5);
    });

    searchBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const zipcode = zipcodeInput.value.trim();

      if (!zipcode || zipcode.length !== 5) {
        showStatus('Please enter a valid 5-digit zip code', 'error');
        return;
      }

      showStatus('Searching for nearby service centers...', 'info');
      searchBtn.classList.add('loading');
      searchBtn.disabled = true;

      setTimeout(() => {
        searchBtn.classList.remove('loading');
        searchBtn.disabled = false;

        currentLocations = digniFiLocations[zipcode] || [];

        if (!currentLocations || currentLocations.length === 0) {
          locationResults.innerHTML = `
            <div class="location-list">
              <div class="no-results">
                No service centers found in zip code ${zipcode}. Try a nearby zip code.
              </div>
            </div>
          `;
          formStatus.innerHTML = '';
          formStatus.className = 'form-status';
          clearMarkers();
          return;
        }

        let html = '<div class="location-list">';
        currentLocations.forEach((location) => {
          const enrolledClass = location.enrolled ? 'enrolled' : 'non-enrolled';
          const badge = location.enrolled 
            ? '<span class="enrollment-badge enrolled">‚úì DigniFi</span>'
            : '<span class="enrollment-badge not-enrolled">Outreach</span>';
          
          const inputType = location.enrolled ? 'radio' : 'checkbox';
          
          html += `
            <label class="location-item ${enrolledClass}">
              <input type="${inputType}" name="${location.enrolled ? 'primaryCenter' : 'outreach'}" value="${location.id}">
              <div class="location-details">
                <div class="checkbox-indicator"></div>
                <div class="location-info">
                  <div class="location-name">${location.name}${badge}</div>
                  <div class="location-address">${location.address}</div>
                  <div class="location-distance">üìç ${location.distance} away</div>
                </div>
              </div>
            </label>
          `;
        });
        html += '</div>';

        locationResults.innerHTML = html;
        formStatus.innerHTML = '';
        formStatus.className = 'form-status';

        addMarkersToMap(currentLocations);

        // Handle radio buttons (primary center - only one)
        document.querySelectorAll('input[name="primaryCenter"]').forEach((radio) => {
          radio.addEventListener('change', (e) => {
            selectedPrimaryCenter = parseInt(e.target.value);
            updateUI();
            updateButtonStates();
          });
        });

        // Handle checkboxes (outreach centers - multiple)
        document.querySelectorAll('input[name="outreach"]').forEach((checkbox) => {
          checkbox.addEventListener('change', (e) => {
            const id = parseInt(e.target.value);
            if (e.target.checked) {
              selectedOutreachCenters.add(id);
            } else {
              selectedOutreachCenters.delete(id);
            }
            updateUI();
            updateButtonStates();
          });
        });
      }, 500);
    });

    function updateUI() {
      addMarkersToMap(currentLocations);
      updateSelectedSummary();
    }

    function updateSelectedSummary() {
      if (!selectedPrimaryCenter && selectedOutreachCenters.size === 0) {
        selectedSummary.innerHTML = '';
        return;
      }

      let html = '<div class="selected-summary"><div class="selected-summary-title">Selected Centers</div>';

      if (selectedPrimaryCenter) {
        const primaryCenter = currentLocations.find(l => l.id === selectedPrimaryCenter);
        html += `<div class="selected-item">${primaryCenter.name} (PreQual)</div>`;
      }

      selectedOutreachCenters.forEach(id => {
        const center = currentLocations.find(l => l.id === id);
        html += `<div class="selected-item outreach">${center.name} (Outreach)</div>`;
      });

      html += '</div>';
      selectedSummary.innerHTML = html;
    }

    function updateButtonStates() {
      const customerName = document.getElementById('customerName').value.trim();
      const customerEmail = document.getElementById('customerEmail').value.trim();
      const customerPhone = document.getElementById('customerPhone').value.trim();
      const hasCustomerInfo = customerName && customerEmail && customerPhone;

      // PreQual button: enabled if customer info + enrolled center selected
      sendPrequalBtn.disabled = !(hasCustomerInfo && selectedPrimaryCenter);

      // Outreach button: enabled if customer info + non-enrolled centers checked
      sendOutreachBtn.disabled = !(hasCustomerInfo && selectedOutreachCenters.size > 0);
    }

    document.getElementById('customerName').addEventListener('input', updateButtonStates);
    document.getElementById('customerEmail').addEventListener('input', updateButtonStates);
    document.getElementById('customerPhone').addEventListener('input', updateButtonStates);

    sendPrequalBtn.addEventListener('click', (e) => {
      e.preventDefault();

      const customerName = document.getElementById('customerName').value.trim();
      const customerEmail = document.getElementById('customerEmail').value.trim();
      const customerPhone = document.getElementById('customerPhone').value.trim();

      if (!customerName || !customerEmail || !customerPhone || !selectedPrimaryCenter) {
        showStatus('Please complete customer info and select a PreQual center', 'error');
        return;
      }

      sendPrequalBtn.disabled = true;
      showStatus('Sending PreQualification invite...', 'info');

      setTimeout(() => {
        const primaryCenter = currentLocations.find(l => l.id === selectedPrimaryCenter);
        const successMessage = `‚úì PreQualification sent to ${customerEmail} via ${primaryCenter.name}!`;

        showStatus(successMessage, 'success');
        sendPrequalBtn.disabled = false;

        setTimeout(() => {
          form.reset();
          locationResults.innerHTML = '';
          selectedSummary.innerHTML = '';
          selectedPrimaryCenter = null;
          selectedOutreachCenters.clear();
          currentLocations = [];
          clearMarkers();
          updateButtonStates();
        }, 2000);
      }, 1500);
    });

    sendOutreachBtn.addEventListener('click', (e) => {
      e.preventDefault();

      const customerEmail = document.getElementById('customerEmail').value.trim();

      if (!customerEmail || selectedOutreachCenters.size === 0) {
        showStatus('Please enter customer email and select outreach centers', 'error');
        return;
      }

      sendOutreachBtn.disabled = true;
      showStatus('Sending lead outreach emails...', 'info');

      setTimeout(() => {
        const count = selectedOutreachCenters.size;
        const successMessage = `‚úì "You Missed a Lead" email${count > 1 ? 's' : ''} sent to ${count} service center${count > 1 ? 's' : ''}!`;

        showStatus(successMessage, 'success');
        sendOutreachBtn.disabled = false;

        setTimeout(() => {
          form.reset();
          locationResults.innerHTML = '';
          selectedSummary.innerHTML = '';
          selectedPrimaryCenter = null;
          selectedOutreachCenters.clear();
          currentLocations = [];
          clearMarkers();
          updateButtonStates();
        }, 2000);
      }, 1500);
    });

    function showStatus(message, type) {
      formStatus.textContent = message;
      formStatus.className = `form-status ${type}`;
    }

    window.addEventListener('load', () => {
      initializeMap();
    });
  </script>
</body>
</html>
